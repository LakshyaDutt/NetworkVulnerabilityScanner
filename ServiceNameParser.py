"""
Created on Sun Jun 18 13:32:45 2023

@author: lakshya
"""
import json

def create_vulnerability_database():
    
    file_path = 'nvdcve-1.1-2023.json'

    
    with open(file_path, 'r', encoding='utf-8') as f:
        data = json.load(f)

    
    vulnerability_database = []

    
    for item in data['CVE_Items']:
        
        cve_id = item['cve']['CVE_data_meta']['ID']

        # Check if 'description_data' list is not empty before accessing its elements
        if item['cve']['description']['description_data']:
            description = item['cve']['description']['description_data'][0]['value']
        else:
            description = ''

        # Process each node in the configurations
        for node in item['configurations']['nodes']:
            if 'cpe_match' in node:
                for cpe in node['cpe_match']:
                    if 'cpe23Uri' in cpe and cpe['vulnerable']:
                        parts = cpe['cpe23Uri'].split(':')
                        if len(parts) >= 6:
                            service_name = parts[3]
                            version = parts[5]

                            # Add the entry to the vulnerability database
                            vulnerability_database.append({
                                "Service": service_name,
                                "Version": version,
                                "CVE ID": cve_id,
                                "Description": description
                            })

    
    with open('vulnerability_database_2023.json', 'w', encoding='utf-8') as f:
        json.dump(vulnerability_database, f, ensure_ascii=False, indent=4)

create_vulnerability_database()
